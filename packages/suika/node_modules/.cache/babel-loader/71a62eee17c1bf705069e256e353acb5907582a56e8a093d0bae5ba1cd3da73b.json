{"ast":null,"code":"import { useEffect, useRef, useState } from 'react';\nimport useLatest from '../useLatest';\nimport useMemoizedFn from '../useMemoizedFn';\nimport useUnmount from '../useUnmount';\nexport var ReadyState;\n(function (ReadyState) {\n  ReadyState[ReadyState[\"Connecting\"] = 0] = \"Connecting\";\n  ReadyState[ReadyState[\"Open\"] = 1] = \"Open\";\n  ReadyState[ReadyState[\"Closing\"] = 2] = \"Closing\";\n  ReadyState[ReadyState[\"Closed\"] = 3] = \"Closed\";\n})(ReadyState || (ReadyState = {}));\nexport default function useWebSocket(socketUrl, options = {}) {\n  const {\n    reconnectLimit = 3,\n    reconnectInterval = 3 * 1000,\n    manual = false,\n    onOpen,\n    onClose,\n    onMessage,\n    onError,\n    protocols\n  } = options;\n  const onOpenRef = useLatest(onOpen);\n  const onCloseRef = useLatest(onClose);\n  const onMessageRef = useLatest(onMessage);\n  const onErrorRef = useLatest(onError);\n  const reconnectTimesRef = useRef(0);\n  const reconnectTimerRef = useRef();\n  const websocketRef = useRef();\n  const unmountedRef = useRef(false);\n  const [latestMessage, setLatestMessage] = useState();\n  const [readyState, setReadyState] = useState(ReadyState.Closed);\n  const reconnect = () => {\n    var _a;\n    if (reconnectTimesRef.current < reconnectLimit && ((_a = websocketRef.current) === null || _a === void 0 ? void 0 : _a.readyState) !== ReadyState.Open) {\n      if (reconnectTimerRef.current) {\n        clearTimeout(reconnectTimerRef.current);\n      }\n      reconnectTimerRef.current = setTimeout(() => {\n        // eslint-disable-next-line @typescript-eslint/no-use-before-define\n        connectWs();\n        reconnectTimesRef.current++;\n      }, reconnectInterval);\n    }\n  };\n  const connectWs = () => {\n    if (reconnectTimerRef.current) {\n      clearTimeout(reconnectTimerRef.current);\n    }\n    if (websocketRef.current) {\n      websocketRef.current.close();\n    }\n    const ws = new WebSocket(socketUrl, protocols);\n    setReadyState(ReadyState.Connecting);\n    ws.onerror = event => {\n      var _a;\n      if (unmountedRef.current) {\n        return;\n      }\n      reconnect();\n      (_a = onErrorRef.current) === null || _a === void 0 ? void 0 : _a.call(onErrorRef, event, ws);\n      setReadyState(ws.readyState || ReadyState.Closed);\n    };\n    ws.onopen = event => {\n      var _a;\n      if (unmountedRef.current) {\n        return;\n      }\n      (_a = onOpenRef.current) === null || _a === void 0 ? void 0 : _a.call(onOpenRef, event, ws);\n      reconnectTimesRef.current = 0;\n      setReadyState(ws.readyState || ReadyState.Open);\n    };\n    ws.onmessage = message => {\n      var _a;\n      if (unmountedRef.current) {\n        return;\n      }\n      (_a = onMessageRef.current) === null || _a === void 0 ? void 0 : _a.call(onMessageRef, message, ws);\n      setLatestMessage(message);\n    };\n    ws.onclose = event => {\n      var _a;\n      if (unmountedRef.current) {\n        return;\n      }\n      reconnect();\n      (_a = onCloseRef.current) === null || _a === void 0 ? void 0 : _a.call(onCloseRef, event, ws);\n      setReadyState(ws.readyState || ReadyState.Closed);\n    };\n    websocketRef.current = ws;\n  };\n  const sendMessage = message => {\n    var _a;\n    if (readyState === ReadyState.Open) {\n      (_a = websocketRef.current) === null || _a === void 0 ? void 0 : _a.send(message);\n    } else {\n      throw new Error('WebSocket disconnected');\n    }\n  };\n  const connect = () => {\n    reconnectTimesRef.current = 0;\n    connectWs();\n  };\n  const disconnect = () => {\n    var _a;\n    if (reconnectTimerRef.current) {\n      clearTimeout(reconnectTimerRef.current);\n    }\n    reconnectTimesRef.current = reconnectLimit;\n    (_a = websocketRef.current) === null || _a === void 0 ? void 0 : _a.close();\n  };\n  useEffect(() => {\n    if (!manual) {\n      connect();\n    }\n  }, [socketUrl, manual]);\n  useUnmount(() => {\n    unmountedRef.current = true;\n    disconnect();\n  });\n  return {\n    latestMessage,\n    sendMessage: useMemoizedFn(sendMessage),\n    connect: useMemoizedFn(connect),\n    disconnect: useMemoizedFn(disconnect),\n    readyState,\n    webSocketIns: websocketRef.current\n  };\n}","map":{"version":3,"names":["useEffect","useRef","useState","useLatest","useMemoizedFn","useUnmount","ReadyState","useWebSocket","socketUrl","options","reconnectLimit","reconnectInterval","manual","onOpen","onClose","onMessage","onError","protocols","onOpenRef","onCloseRef","onMessageRef","onErrorRef","reconnectTimesRef","reconnectTimerRef","websocketRef","unmountedRef","latestMessage","setLatestMessage","readyState","setReadyState","Closed","reconnect","_a","current","Open","clearTimeout","setTimeout","connectWs","close","ws","WebSocket","Connecting","onerror","event","call","onopen","onmessage","message","onclose","sendMessage","send","Error","connect","disconnect","webSocketIns"],"sources":["/Users/yangdan/zf-workspace/react/suika/node_modules/.pnpm/registry.npmmirror.com+ahooks@3.7.4_react@18.2.0/node_modules/ahooks/es/useWebSocket/index.js"],"sourcesContent":["import { useEffect, useRef, useState } from 'react';\nimport useLatest from '../useLatest';\nimport useMemoizedFn from '../useMemoizedFn';\nimport useUnmount from '../useUnmount';\nexport var ReadyState;\n(function (ReadyState) {\n  ReadyState[ReadyState[\"Connecting\"] = 0] = \"Connecting\";\n  ReadyState[ReadyState[\"Open\"] = 1] = \"Open\";\n  ReadyState[ReadyState[\"Closing\"] = 2] = \"Closing\";\n  ReadyState[ReadyState[\"Closed\"] = 3] = \"Closed\";\n})(ReadyState || (ReadyState = {}));\nexport default function useWebSocket(socketUrl, options = {}) {\n  const {\n    reconnectLimit = 3,\n    reconnectInterval = 3 * 1000,\n    manual = false,\n    onOpen,\n    onClose,\n    onMessage,\n    onError,\n    protocols\n  } = options;\n  const onOpenRef = useLatest(onOpen);\n  const onCloseRef = useLatest(onClose);\n  const onMessageRef = useLatest(onMessage);\n  const onErrorRef = useLatest(onError);\n  const reconnectTimesRef = useRef(0);\n  const reconnectTimerRef = useRef();\n  const websocketRef = useRef();\n  const unmountedRef = useRef(false);\n  const [latestMessage, setLatestMessage] = useState();\n  const [readyState, setReadyState] = useState(ReadyState.Closed);\n  const reconnect = () => {\n    var _a;\n    if (reconnectTimesRef.current < reconnectLimit && ((_a = websocketRef.current) === null || _a === void 0 ? void 0 : _a.readyState) !== ReadyState.Open) {\n      if (reconnectTimerRef.current) {\n        clearTimeout(reconnectTimerRef.current);\n      }\n      reconnectTimerRef.current = setTimeout(() => {\n        // eslint-disable-next-line @typescript-eslint/no-use-before-define\n        connectWs();\n        reconnectTimesRef.current++;\n      }, reconnectInterval);\n    }\n  };\n  const connectWs = () => {\n    if (reconnectTimerRef.current) {\n      clearTimeout(reconnectTimerRef.current);\n    }\n    if (websocketRef.current) {\n      websocketRef.current.close();\n    }\n    const ws = new WebSocket(socketUrl, protocols);\n    setReadyState(ReadyState.Connecting);\n    ws.onerror = event => {\n      var _a;\n      if (unmountedRef.current) {\n        return;\n      }\n      reconnect();\n      (_a = onErrorRef.current) === null || _a === void 0 ? void 0 : _a.call(onErrorRef, event, ws);\n      setReadyState(ws.readyState || ReadyState.Closed);\n    };\n    ws.onopen = event => {\n      var _a;\n      if (unmountedRef.current) {\n        return;\n      }\n      (_a = onOpenRef.current) === null || _a === void 0 ? void 0 : _a.call(onOpenRef, event, ws);\n      reconnectTimesRef.current = 0;\n      setReadyState(ws.readyState || ReadyState.Open);\n    };\n    ws.onmessage = message => {\n      var _a;\n      if (unmountedRef.current) {\n        return;\n      }\n      (_a = onMessageRef.current) === null || _a === void 0 ? void 0 : _a.call(onMessageRef, message, ws);\n      setLatestMessage(message);\n    };\n    ws.onclose = event => {\n      var _a;\n      if (unmountedRef.current) {\n        return;\n      }\n      reconnect();\n      (_a = onCloseRef.current) === null || _a === void 0 ? void 0 : _a.call(onCloseRef, event, ws);\n      setReadyState(ws.readyState || ReadyState.Closed);\n    };\n    websocketRef.current = ws;\n  };\n  const sendMessage = message => {\n    var _a;\n    if (readyState === ReadyState.Open) {\n      (_a = websocketRef.current) === null || _a === void 0 ? void 0 : _a.send(message);\n    } else {\n      throw new Error('WebSocket disconnected');\n    }\n  };\n  const connect = () => {\n    reconnectTimesRef.current = 0;\n    connectWs();\n  };\n  const disconnect = () => {\n    var _a;\n    if (reconnectTimerRef.current) {\n      clearTimeout(reconnectTimerRef.current);\n    }\n    reconnectTimesRef.current = reconnectLimit;\n    (_a = websocketRef.current) === null || _a === void 0 ? void 0 : _a.close();\n  };\n  useEffect(() => {\n    if (!manual) {\n      connect();\n    }\n  }, [socketUrl, manual]);\n  useUnmount(() => {\n    unmountedRef.current = true;\n    disconnect();\n  });\n  return {\n    latestMessage,\n    sendMessage: useMemoizedFn(sendMessage),\n    connect: useMemoizedFn(connect),\n    disconnect: useMemoizedFn(disconnect),\n    readyState,\n    webSocketIns: websocketRef.current\n  };\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}