{"ast":null,"code":"import { __awaiter, __rest } from \"tslib\";\n/* eslint-disable @typescript-eslint/no-parameter-properties */\nimport { isFunction } from '../../utils';\nexport default class Fetch {\n  constructor(serviceRef, options, subscribe, initState = {}) {\n    this.serviceRef = serviceRef;\n    this.options = options;\n    this.subscribe = subscribe;\n    this.initState = initState;\n    this.count = 0;\n    this.state = {\n      loading: false,\n      params: undefined,\n      data: undefined,\n      error: undefined\n    };\n    this.state = Object.assign(Object.assign(Object.assign({}, this.state), {\n      loading: !options.manual\n    }), initState);\n  }\n  setState(s = {}) {\n    this.state = Object.assign(Object.assign({}, this.state), s);\n    this.subscribe();\n  }\n  runPluginHandler(event, ...rest) {\n    // @ts-ignore\n    const r = this.pluginImpls.map(i => {\n      var _a;\n      return (_a = i[event]) === null || _a === void 0 ? void 0 : _a.call(i, ...rest);\n    }).filter(Boolean);\n    return Object.assign({}, ...r);\n  }\n  runAsync(...params) {\n    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;\n    return __awaiter(this, void 0, void 0, function* () {\n      this.count += 1;\n      const currentCount = this.count;\n      const _l = this.runPluginHandler('onBefore', params),\n        {\n          stopNow = false,\n          returnNow = false\n        } = _l,\n        state = __rest(_l, [\"stopNow\", \"returnNow\"]);\n      // stop request\n      if (stopNow) {\n        return new Promise(() => {});\n      }\n      this.setState(Object.assign({\n        loading: true,\n        params\n      }, state));\n      // return now\n      if (returnNow) {\n        return Promise.resolve(state.data);\n      }\n      (_b = (_a = this.options).onBefore) === null || _b === void 0 ? void 0 : _b.call(_a, params);\n      try {\n        // replace service\n        let {\n          servicePromise\n        } = this.runPluginHandler('onRequest', this.serviceRef.current, params);\n        if (!servicePromise) {\n          servicePromise = this.serviceRef.current(...params);\n        }\n        const res = yield servicePromise;\n        if (currentCount !== this.count) {\n          // prevent run.then when request is canceled\n          return new Promise(() => {});\n        }\n        // const formattedResult = this.options.formatResultRef.current ? this.options.formatResultRef.current(res) : res;\n        this.setState({\n          data: res,\n          error: undefined,\n          loading: false\n        });\n        (_d = (_c = this.options).onSuccess) === null || _d === void 0 ? void 0 : _d.call(_c, res, params);\n        this.runPluginHandler('onSuccess', res, params);\n        (_f = (_e = this.options).onFinally) === null || _f === void 0 ? void 0 : _f.call(_e, params, res, undefined);\n        if (currentCount === this.count) {\n          this.runPluginHandler('onFinally', params, res, undefined);\n        }\n        return res;\n      } catch (error) {\n        if (currentCount !== this.count) {\n          // prevent run.then when request is canceled\n          return new Promise(() => {});\n        }\n        this.setState({\n          error,\n          loading: false\n        });\n        (_h = (_g = this.options).onError) === null || _h === void 0 ? void 0 : _h.call(_g, error, params);\n        this.runPluginHandler('onError', error, params);\n        (_k = (_j = this.options).onFinally) === null || _k === void 0 ? void 0 : _k.call(_j, params, undefined, error);\n        if (currentCount === this.count) {\n          this.runPluginHandler('onFinally', params, undefined, error);\n        }\n        throw error;\n      }\n    });\n  }\n  run(...params) {\n    this.runAsync(...params).catch(error => {\n      if (!this.options.onError) {\n        console.error(error);\n      }\n    });\n  }\n  cancel() {\n    this.count += 1;\n    this.setState({\n      loading: false\n    });\n    this.runPluginHandler('onCancel');\n  }\n  refresh() {\n    // @ts-ignore\n    this.run(...(this.state.params || []));\n  }\n  refreshAsync() {\n    // @ts-ignore\n    return this.runAsync(...(this.state.params || []));\n  }\n  mutate(data) {\n    const targetData = isFunction(data) ? data(this.state.data) : data;\n    this.runPluginHandler('onMutate', targetData);\n    this.setState({\n      data: targetData\n    });\n  }\n}","map":{"version":3,"names":["__awaiter","__rest","isFunction","Fetch","constructor","serviceRef","options","subscribe","initState","count","state","loading","params","undefined","data","error","Object","assign","manual","setState","s","runPluginHandler","event","rest","r","pluginImpls","map","i","_a","call","filter","Boolean","runAsync","_b","_c","_d","_e","_f","_g","_h","_j","_k","currentCount","_l","stopNow","returnNow","Promise","resolve","onBefore","servicePromise","current","res","onSuccess","onFinally","onError","run","catch","console","cancel","refresh","refreshAsync","mutate","targetData"],"sources":["/Users/yangdan/zf-workspace/react/suika/node_modules/.pnpm/registry.npmmirror.com+ahooks@3.7.4_react@18.2.0/node_modules/ahooks/es/useRequest/src/Fetch.js"],"sourcesContent":["import { __awaiter, __rest } from \"tslib\";\n/* eslint-disable @typescript-eslint/no-parameter-properties */\nimport { isFunction } from '../../utils';\nexport default class Fetch {\n  constructor(serviceRef, options, subscribe, initState = {}) {\n    this.serviceRef = serviceRef;\n    this.options = options;\n    this.subscribe = subscribe;\n    this.initState = initState;\n    this.count = 0;\n    this.state = {\n      loading: false,\n      params: undefined,\n      data: undefined,\n      error: undefined\n    };\n    this.state = Object.assign(Object.assign(Object.assign({}, this.state), {\n      loading: !options.manual\n    }), initState);\n  }\n  setState(s = {}) {\n    this.state = Object.assign(Object.assign({}, this.state), s);\n    this.subscribe();\n  }\n  runPluginHandler(event, ...rest) {\n    // @ts-ignore\n    const r = this.pluginImpls.map(i => {\n      var _a;\n      return (_a = i[event]) === null || _a === void 0 ? void 0 : _a.call(i, ...rest);\n    }).filter(Boolean);\n    return Object.assign({}, ...r);\n  }\n  runAsync(...params) {\n    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;\n    return __awaiter(this, void 0, void 0, function* () {\n      this.count += 1;\n      const currentCount = this.count;\n      const _l = this.runPluginHandler('onBefore', params),\n        {\n          stopNow = false,\n          returnNow = false\n        } = _l,\n        state = __rest(_l, [\"stopNow\", \"returnNow\"]);\n      // stop request\n      if (stopNow) {\n        return new Promise(() => {});\n      }\n      this.setState(Object.assign({\n        loading: true,\n        params\n      }, state));\n      // return now\n      if (returnNow) {\n        return Promise.resolve(state.data);\n      }\n      (_b = (_a = this.options).onBefore) === null || _b === void 0 ? void 0 : _b.call(_a, params);\n      try {\n        // replace service\n        let {\n          servicePromise\n        } = this.runPluginHandler('onRequest', this.serviceRef.current, params);\n        if (!servicePromise) {\n          servicePromise = this.serviceRef.current(...params);\n        }\n        const res = yield servicePromise;\n        if (currentCount !== this.count) {\n          // prevent run.then when request is canceled\n          return new Promise(() => {});\n        }\n        // const formattedResult = this.options.formatResultRef.current ? this.options.formatResultRef.current(res) : res;\n        this.setState({\n          data: res,\n          error: undefined,\n          loading: false\n        });\n        (_d = (_c = this.options).onSuccess) === null || _d === void 0 ? void 0 : _d.call(_c, res, params);\n        this.runPluginHandler('onSuccess', res, params);\n        (_f = (_e = this.options).onFinally) === null || _f === void 0 ? void 0 : _f.call(_e, params, res, undefined);\n        if (currentCount === this.count) {\n          this.runPluginHandler('onFinally', params, res, undefined);\n        }\n        return res;\n      } catch (error) {\n        if (currentCount !== this.count) {\n          // prevent run.then when request is canceled\n          return new Promise(() => {});\n        }\n        this.setState({\n          error,\n          loading: false\n        });\n        (_h = (_g = this.options).onError) === null || _h === void 0 ? void 0 : _h.call(_g, error, params);\n        this.runPluginHandler('onError', error, params);\n        (_k = (_j = this.options).onFinally) === null || _k === void 0 ? void 0 : _k.call(_j, params, undefined, error);\n        if (currentCount === this.count) {\n          this.runPluginHandler('onFinally', params, undefined, error);\n        }\n        throw error;\n      }\n    });\n  }\n  run(...params) {\n    this.runAsync(...params).catch(error => {\n      if (!this.options.onError) {\n        console.error(error);\n      }\n    });\n  }\n  cancel() {\n    this.count += 1;\n    this.setState({\n      loading: false\n    });\n    this.runPluginHandler('onCancel');\n  }\n  refresh() {\n    // @ts-ignore\n    this.run(...(this.state.params || []));\n  }\n  refreshAsync() {\n    // @ts-ignore\n    return this.runAsync(...(this.state.params || []));\n  }\n  mutate(data) {\n    const targetData = isFunction(data) ? data(this.state.data) : data;\n    this.runPluginHandler('onMutate', targetData);\n    this.setState({\n      data: targetData\n    });\n  }\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}