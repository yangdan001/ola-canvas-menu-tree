{"ast":null,"code":"import cloneDeep from 'lodash.clonedeep';\nimport { Line } from '../scene/line';\nimport { DrawGraphTool } from './tool_draw_graph';\nimport { calcVectorRadian, normalizeRadian } from '../../utils/graphics';\nimport { transformRotate } from '../../utils/transform';\nimport { HALF_PI } from '../../constant';\nexport class DrawLineTool extends DrawGraphTool {\n  constructor(editor) {\n    super(editor);\n    this.type = 'drawLine';\n    this.hotkey = 'l';\n    this.commandDesc = 'Add Line';\n  }\n  createGraph(rect, noMove) {\n    // do not create line if no drag\n    if (noMove) {\n      return null;\n    }\n    const attrs = this.calcAttrs(rect);\n    return new Line({\n      ...attrs,\n      height: 0,\n      stroke: [cloneDeep(this.editor.setting.get('firstStroke'))],\n      strokeWidth: this.editor.setting.get('strokeWidth')\n    });\n  }\n  adjustSizeWhenShiftPressing(rect) {\n    const radian = calcVectorRadian(rect.x, rect.y, rect.x + rect.width, rect.y + rect.height);\n    const {\n      width,\n      height\n    } = rect;\n    const remainder = radian % HALF_PI;\n    if (remainder < Math.PI / 8 || remainder > Math.PI * 3 / 8) {\n      if (Math.abs(width) > Math.abs(height)) {\n        rect.height = 0;\n      } else {\n        rect.width = 0;\n      }\n    } else {\n      const min = Math.min(Math.abs(width), Math.abs(height));\n      const max = Math.max(Math.abs(width), Math.abs(height));\n      const size = min + (max - min) / 2;\n      rect.height = (Math.sign(height) || 1) * size;\n      rect.width = (Math.sign(width) || 1) * size;\n    }\n  }\n  updateGraph(rect) {\n    const attrs = this.calcAttrs(rect);\n    Object.assign(this.drawingGraph, attrs);\n  }\n  calcAttrs({\n    x,\n    y,\n    width,\n    height\n  }) {\n    const rotation = normalizeRadian(Math.atan2(height, width));\n    const cx = x + width / 2;\n    const cy = y + height / 2;\n    const p = transformRotate(x, y, -rotation, cx, cy);\n    width = Math.sqrt(width * width + height * height);\n    return {\n      x: p.x,\n      y: p.y,\n      width,\n      rotation\n    };\n  }\n}\nDrawLineTool.type = 'drawLine';","map":{"version":3,"names":["cloneDeep","Line","DrawGraphTool","calcVectorRadian","normalizeRadian","transformRotate","HALF_PI","DrawLineTool","constructor","editor","type","hotkey","commandDesc","createGraph","rect","noMove","attrs","calcAttrs","height","stroke","setting","get","strokeWidth","adjustSizeWhenShiftPressing","radian","x","y","width","remainder","Math","PI","abs","min","max","size","sign","updateGraph","Object","assign","drawingGraph","rotation","atan2","cx","cy","p","sqrt"],"sources":["/Users/yangdan/zf-workspace/react/suika/packages/suika/src/editor/tools/tool_draw_line.tsx"],"sourcesContent":["import cloneDeep from 'lodash.clonedeep';\nimport { Editor } from '../editor';\nimport { Line } from '../scene/line';\nimport { DrawGraphTool } from './tool_draw_graph';\nimport { ITool } from './type';\nimport { IRect } from '../../type';\nimport { calcVectorRadian, normalizeRadian } from '../../utils/graphics';\nimport { transformRotate } from '../../utils/transform';\nimport { HALF_PI } from '../../constant';\n\nexport class DrawLineTool extends DrawGraphTool implements ITool {\n  static readonly type = 'drawLine';\n  readonly type = 'drawLine';\n  readonly hotkey = 'l';\n\n  constructor(editor: Editor) {\n    super(editor);\n    this.commandDesc = 'Add Line';\n  }\n\n  protected createGraph(rect: IRect, noMove: boolean) {\n    // do not create line if no drag\n    if (noMove) {\n      return null;\n    }\n    const attrs = this.calcAttrs(rect);\n    return new Line({\n      ...attrs,\n      height: 0,\n      stroke: [cloneDeep(this.editor.setting.get('firstStroke'))],\n      strokeWidth: this.editor.setting.get('strokeWidth'),\n    });\n  }\n\n  protected adjustSizeWhenShiftPressing(rect: IRect) {\n    const radian = calcVectorRadian(\n      rect.x,\n      rect.y,\n      rect.x + rect.width,\n      rect.y + rect.height,\n    );\n\n    const { width, height } = rect;\n    const remainder = radian % HALF_PI;\n    if (remainder < Math.PI / 8 || remainder > (Math.PI * 3) / 8) {\n      if (Math.abs(width) > Math.abs(height)) {\n        rect.height = 0;\n      } else {\n        rect.width = 0;\n      }\n    } else {\n      const min = Math.min(Math.abs(width), Math.abs(height));\n      const max = Math.max(Math.abs(width), Math.abs(height));\n      const size = min + (max - min) / 2;\n\n      rect.height = (Math.sign(height) || 1) * size;\n      rect.width = (Math.sign(width) || 1) * size;\n    }\n  }\n\n  protected updateGraph(rect: IRect) {\n    const attrs = this.calcAttrs(rect);\n    Object.assign(this.drawingGraph!, attrs);\n  }\n\n  private calcAttrs({ x, y, width, height }: IRect) {\n    const rotation = normalizeRadian(Math.atan2(height, width));\n    const cx = x + width / 2;\n    const cy = y + height / 2;\n    const p = transformRotate(x, y, -rotation, cx, cy);\n    width = Math.sqrt(width * width + height * height);\n    return {\n      x: p.x,\n      y: p.y,\n      width,\n      rotation,\n    };\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}