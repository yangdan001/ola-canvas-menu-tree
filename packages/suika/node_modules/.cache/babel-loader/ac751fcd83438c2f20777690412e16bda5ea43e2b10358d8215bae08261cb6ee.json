{"ast":null,"code":"import EventEmitter from '../../utils/event_emitter';\nexport class CommandManager {\n  constructor(editor) {\n    this.editor = editor;\n    this.redoStack = [];\n    this.undoStack = [];\n    this.isEnableRedoUndo = true;\n    this.emitter = new EventEmitter();\n  }\n  redo() {\n    if (!this.isEnableRedoUndo) {\n      return;\n    }\n    if (this.redoStack.length > 0) {\n      const command = this.redoStack.pop();\n      console.log(`%c Redo %c ${command.desc}`, 'background: #f04; color: #ee0', '');\n      this.undoStack.push(command);\n      command.redo();\n      this.editor.sceneGraph.render();\n      this.emitStatusChange();\n    }\n  }\n  undo() {\n    if (!this.isEnableRedoUndo) {\n      return;\n    }\n    if (this.undoStack.length > 0) {\n      const command = this.undoStack.pop();\n      console.log(`%c Undo %c ${command.desc}`, 'background: #40f; color: #eee', '');\n      this.redoStack.push(command);\n      command.undo();\n      this.editor.sceneGraph.render();\n      this.emitStatusChange();\n    }\n  }\n  enableRedoUndo() {\n    this.isEnableRedoUndo = true;\n  }\n  disableRedoUndo() {\n    this.isEnableRedoUndo = false;\n  }\n  pushCommand(command) {\n    this.emitter.emit('beforeExecCmd');\n    console.log(`%c Exec %c ${command.desc}`, 'background: #222; color: #bada55', '');\n    this.undoStack.push(command);\n    this.redoStack = [];\n    this.emitStatusChange();\n  }\n  emitStatusChange() {\n    this.emitter.emit('change', {\n      canRedo: this.redoStack.length > 0,\n      canUndo: this.undoStack.length > 0\n    });\n  }\n  on(eventName, listener) {\n    this.emitter.on(eventName, listener);\n  }\n  off(eventName, listener) {\n    this.emitter.off(eventName, listener);\n  }\n}","map":{"version":3,"names":["EventEmitter","CommandManager","constructor","editor","redoStack","undoStack","isEnableRedoUndo","emitter","redo","length","command","pop","console","log","desc","push","sceneGraph","render","emitStatusChange","undo","enableRedoUndo","disableRedoUndo","pushCommand","emit","canRedo","canUndo","on","eventName","listener","off"],"sources":["/Users/yangdan/zf-workspace/react/suika/packages/suika/src/editor/commands/command_manager.ts"],"sourcesContent":["import EventEmitter from '../../utils/event_emitter';\nimport { Editor } from '../editor';\nimport { ICommand } from './type';\n\nexport interface IHistoryStatus {\n  canRedo: boolean;\n  canUndo: boolean;\n}\n\ninterface Events {\n  change(status: IHistoryStatus): void;\n  beforeExecCmd(): void;\n}\n\nexport class CommandManager {\n  redoStack: ICommand[] = [];\n  undoStack: ICommand[] = [];\n  private isEnableRedoUndo = true;\n  private emitter = new EventEmitter<Events>();\n\n  constructor(private editor: Editor) {}\n\n  redo() {\n    if (!this.isEnableRedoUndo) {\n      return;\n    }\n    if (this.redoStack.length > 0) {\n      const command = this.redoStack.pop()!;\n      console.log(\n        `%c Redo %c ${command.desc}`,\n        'background: #f04; color: #ee0',\n        '',\n      );\n      this.undoStack.push(command);\n      command.redo();\n\n      this.editor.sceneGraph.render();\n      this.emitStatusChange();\n    }\n  }\n  undo() {\n    if (!this.isEnableRedoUndo) {\n      return;\n    }\n    if (this.undoStack.length > 0) {\n      const command = this.undoStack.pop()!;\n      console.log(\n        `%c Undo %c ${command.desc}`,\n        'background: #40f; color: #eee',\n        '',\n      );\n      this.redoStack.push(command);\n      command.undo();\n\n      this.editor.sceneGraph.render();\n      this.emitStatusChange();\n    }\n  }\n  enableRedoUndo() {\n    this.isEnableRedoUndo = true;\n  }\n  disableRedoUndo() {\n    this.isEnableRedoUndo = false;\n  }\n  pushCommand(command: ICommand) {\n    this.emitter.emit('beforeExecCmd');\n    console.log(\n      `%c Exec %c ${command.desc}`,\n      'background: #222; color: #bada55',\n      '',\n    );\n    this.undoStack.push(command);\n    this.redoStack = [];\n    this.emitStatusChange();\n  }\n  private emitStatusChange() {\n    this.emitter.emit('change', {\n      canRedo: this.redoStack.length > 0,\n      canUndo: this.undoStack.length > 0,\n    });\n  }\n  on<T extends keyof Events>(eventName: T, listener: Events[T]) {\n    this.emitter.on(eventName, listener);\n  }\n  off<T extends keyof Events>(eventName: T, listener: Events[T]) {\n    this.emitter.off(eventName, listener);\n  }\n}\n"],"mappings":"AAAA,OAAOA,YAAY,MAAM,2BAA2B;AAcpD,OAAO,MAAMC,cAAc,CAAC;EAM1BC,WAAWA,CAASC,MAAc,EAAE;IAAA,KAAhBA,MAAc,GAAdA,MAAc;IAAA,KALlCC,SAAS,GAAe,EAAE;IAAA,KAC1BC,SAAS,GAAe,EAAE;IAAA,KAClBC,gBAAgB,GAAG,IAAI;IAAA,KACvBC,OAAO,GAAG,IAAIP,YAAY,CAAS,CAAC;EAEP;EAErCQ,IAAIA,CAAA,EAAG;IACL,IAAI,CAAC,IAAI,CAACF,gBAAgB,EAAE;MAC1B;IACF;IACA,IAAI,IAAI,CAACF,SAAS,CAACK,MAAM,GAAG,CAAC,EAAE;MAC7B,MAAMC,OAAO,GAAG,IAAI,CAACN,SAAS,CAACO,GAAG,CAAC,CAAE;MACrCC,OAAO,CAACC,GAAG,CACR,cAAaH,OAAO,CAACI,IAAK,EAAC,EAC5B,+BAA+B,EAC/B,EACF,CAAC;MACD,IAAI,CAACT,SAAS,CAACU,IAAI,CAACL,OAAO,CAAC;MAC5BA,OAAO,CAACF,IAAI,CAAC,CAAC;MAEd,IAAI,CAACL,MAAM,CAACa,UAAU,CAACC,MAAM,CAAC,CAAC;MAC/B,IAAI,CAACC,gBAAgB,CAAC,CAAC;IACzB;EACF;EACAC,IAAIA,CAAA,EAAG;IACL,IAAI,CAAC,IAAI,CAACb,gBAAgB,EAAE;MAC1B;IACF;IACA,IAAI,IAAI,CAACD,SAAS,CAACI,MAAM,GAAG,CAAC,EAAE;MAC7B,MAAMC,OAAO,GAAG,IAAI,CAACL,SAAS,CAACM,GAAG,CAAC,CAAE;MACrCC,OAAO,CAACC,GAAG,CACR,cAAaH,OAAO,CAACI,IAAK,EAAC,EAC5B,+BAA+B,EAC/B,EACF,CAAC;MACD,IAAI,CAACV,SAAS,CAACW,IAAI,CAACL,OAAO,CAAC;MAC5BA,OAAO,CAACS,IAAI,CAAC,CAAC;MAEd,IAAI,CAAChB,MAAM,CAACa,UAAU,CAACC,MAAM,CAAC,CAAC;MAC/B,IAAI,CAACC,gBAAgB,CAAC,CAAC;IACzB;EACF;EACAE,cAAcA,CAAA,EAAG;IACf,IAAI,CAACd,gBAAgB,GAAG,IAAI;EAC9B;EACAe,eAAeA,CAAA,EAAG;IAChB,IAAI,CAACf,gBAAgB,GAAG,KAAK;EAC/B;EACAgB,WAAWA,CAACZ,OAAiB,EAAE;IAC7B,IAAI,CAACH,OAAO,CAACgB,IAAI,CAAC,eAAe,CAAC;IAClCX,OAAO,CAACC,GAAG,CACR,cAAaH,OAAO,CAACI,IAAK,EAAC,EAC5B,kCAAkC,EAClC,EACF,CAAC;IACD,IAAI,CAACT,SAAS,CAACU,IAAI,CAACL,OAAO,CAAC;IAC5B,IAAI,CAACN,SAAS,GAAG,EAAE;IACnB,IAAI,CAACc,gBAAgB,CAAC,CAAC;EACzB;EACQA,gBAAgBA,CAAA,EAAG;IACzB,IAAI,CAACX,OAAO,CAACgB,IAAI,CAAC,QAAQ,EAAE;MAC1BC,OAAO,EAAE,IAAI,CAACpB,SAAS,CAACK,MAAM,GAAG,CAAC;MAClCgB,OAAO,EAAE,IAAI,CAACpB,SAAS,CAACI,MAAM,GAAG;IACnC,CAAC,CAAC;EACJ;EACAiB,EAAEA,CAAyBC,SAAY,EAAEC,QAAmB,EAAE;IAC5D,IAAI,CAACrB,OAAO,CAACmB,EAAE,CAACC,SAAS,EAAEC,QAAQ,CAAC;EACtC;EACAC,GAAGA,CAAyBF,SAAY,EAAEC,QAAmB,EAAE;IAC7D,IAAI,CAACrB,OAAO,CAACsB,GAAG,CAACF,SAAS,EAAEC,QAAQ,CAAC;EACvC;AACF"},"metadata":{},"sourceType":"module","externalDependencies":[]}