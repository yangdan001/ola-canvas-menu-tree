{"ast":null,"code":"import dayjs from 'dayjs';\nimport { useEffect, useMemo, useState } from 'react';\nimport useLatest from '../useLatest';\nimport { isNumber } from '../utils/index';\nconst calcLeft = target => {\n  if (!target) {\n    return 0;\n  }\n  // https://stackoverflow.com/questions/4310953/invalid-date-in-safari\n  const left = dayjs(target).valueOf() - Date.now();\n  return left < 0 ? 0 : left;\n};\nconst parseMs = milliseconds => {\n  return {\n    days: Math.floor(milliseconds / 86400000),\n    hours: Math.floor(milliseconds / 3600000) % 24,\n    minutes: Math.floor(milliseconds / 60000) % 60,\n    seconds: Math.floor(milliseconds / 1000) % 60,\n    milliseconds: Math.floor(milliseconds) % 1000\n  };\n};\nconst useCountdown = (options = {}) => {\n  const {\n    leftTime,\n    targetDate,\n    interval = 1000,\n    onEnd\n  } = options || {};\n  const target = useMemo(() => {\n    if ('leftTime' in options) {\n      return isNumber(leftTime) && leftTime > 0 ? Date.now() + leftTime : undefined;\n    } else {\n      return targetDate;\n    }\n  }, [leftTime, targetDate]);\n  const [timeLeft, setTimeLeft] = useState(() => calcLeft(target));\n  const onEndRef = useLatest(onEnd);\n  useEffect(() => {\n    if (!target) {\n      // for stop\n      setTimeLeft(0);\n      return;\n    }\n    // 立即执行一次\n    setTimeLeft(calcLeft(target));\n    const timer = setInterval(() => {\n      var _a;\n      const targetLeft = calcLeft(target);\n      setTimeLeft(targetLeft);\n      if (targetLeft === 0) {\n        clearInterval(timer);\n        (_a = onEndRef.current) === null || _a === void 0 ? void 0 : _a.call(onEndRef);\n      }\n    }, interval);\n    return () => clearInterval(timer);\n  }, [target, interval]);\n  const formattedRes = useMemo(() => parseMs(timeLeft), [timeLeft]);\n  return [timeLeft, formattedRes];\n};\nexport default useCountdown;","map":{"version":3,"names":["dayjs","useEffect","useMemo","useState","useLatest","isNumber","calcLeft","target","left","valueOf","Date","now","parseMs","milliseconds","days","Math","floor","hours","minutes","seconds","useCountdown","options","leftTime","targetDate","interval","onEnd","undefined","timeLeft","setTimeLeft","onEndRef","timer","setInterval","_a","targetLeft","clearInterval","current","call","formattedRes"],"sources":["/Users/yangdan/zf-workspace/react/suika/node_modules/.pnpm/registry.npmmirror.com+ahooks@3.7.4_react@18.2.0/node_modules/ahooks/es/useCountDown/index.js"],"sourcesContent":["import dayjs from 'dayjs';\nimport { useEffect, useMemo, useState } from 'react';\nimport useLatest from '../useLatest';\nimport { isNumber } from '../utils/index';\nconst calcLeft = target => {\n  if (!target) {\n    return 0;\n  }\n  // https://stackoverflow.com/questions/4310953/invalid-date-in-safari\n  const left = dayjs(target).valueOf() - Date.now();\n  return left < 0 ? 0 : left;\n};\nconst parseMs = milliseconds => {\n  return {\n    days: Math.floor(milliseconds / 86400000),\n    hours: Math.floor(milliseconds / 3600000) % 24,\n    minutes: Math.floor(milliseconds / 60000) % 60,\n    seconds: Math.floor(milliseconds / 1000) % 60,\n    milliseconds: Math.floor(milliseconds) % 1000\n  };\n};\nconst useCountdown = (options = {}) => {\n  const {\n    leftTime,\n    targetDate,\n    interval = 1000,\n    onEnd\n  } = options || {};\n  const target = useMemo(() => {\n    if ('leftTime' in options) {\n      return isNumber(leftTime) && leftTime > 0 ? Date.now() + leftTime : undefined;\n    } else {\n      return targetDate;\n    }\n  }, [leftTime, targetDate]);\n  const [timeLeft, setTimeLeft] = useState(() => calcLeft(target));\n  const onEndRef = useLatest(onEnd);\n  useEffect(() => {\n    if (!target) {\n      // for stop\n      setTimeLeft(0);\n      return;\n    }\n    // 立即执行一次\n    setTimeLeft(calcLeft(target));\n    const timer = setInterval(() => {\n      var _a;\n      const targetLeft = calcLeft(target);\n      setTimeLeft(targetLeft);\n      if (targetLeft === 0) {\n        clearInterval(timer);\n        (_a = onEndRef.current) === null || _a === void 0 ? void 0 : _a.call(onEndRef);\n      }\n    }, interval);\n    return () => clearInterval(timer);\n  }, [target, interval]);\n  const formattedRes = useMemo(() => parseMs(timeLeft), [timeLeft]);\n  return [timeLeft, formattedRes];\n};\nexport default useCountdown;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}