{"ast":null,"code":"import cloneDeep from 'lodash.clonedeep';\nimport { TextGraph } from '../scene/text';\nimport { AddShapeCommand } from '../commands/add_shape';\nexport class TextEditor {\n  constructor(editor) {\n    this.editor = editor;\n    this.textarea = void 0;\n    this.x = -1;\n    this.y = -1;\n    this.textarea = document.createElement('input');\n    this.setStyle();\n    this.hide();\n    this.bindEvent();\n    editor.containerElement.appendChild(this.textarea);\n  }\n  setStyle() {\n    const styles = {\n      background: 'transparent',\n      border: 'none',\n      outline: 'none',\n      resize: 'none',\n      padding: '0',\n      fontFamily: 'sans-serif',\n      lineHeight: '1',\n      position: 'absolute',\n      overflow: 'hidden',\n      width: '240px',\n      zIndex: '20'\n    };\n    Object.assign(this.textarea.style, styles);\n  }\n  bindEvent() {\n    this.textarea.addEventListener('keydown', e => {\n      if (e.key === 'Escape') {\n        this.hide();\n      }\n    });\n    this.textarea.addEventListener('blur', () => {\n      this.createTextGraph();\n      this.hide();\n    });\n  }\n  createTextGraph() {\n    if (!this.textarea.value) return;\n    const sceneXY = this.editor.viewportCoordsToScene(this.x, this.y, this.editor.setting.get('snapToPixelGrid'));\n    const text = new TextGraph({\n      x: sceneXY.x,\n      y: sceneXY.y,\n      content: this.textarea.value,\n      autoFit: true,\n      fontSize: this.editor.setting.get('defaultFontSize'),\n      height: this.editor.setting.get('defaultFontSize'),\n      fill: cloneDeep(this.editor.setting.get('textFill'))\n    });\n    this.editor.sceneGraph.addItems([text]);\n    this.editor.selectedElements.setItems([text]);\n    this.editor.sceneGraph.render();\n    this.editor.commandManager.pushCommand(new AddShapeCommand('draw text', this.editor, [text]));\n  }\n  visible(x, y) {\n    this.x = x;\n    this.y = y;\n    const zoom = this.editor.zoomManager.getZoom();\n    const textarea = this.textarea;\n    const fontSize = this.editor.setting.get('defaultFontSize') * zoom + 'px';\n    const styles = {\n      left: x + 'px',\n      top: y + 'px',\n      height: fontSize,\n      fontSize,\n      display: 'block'\n    };\n    Object.assign(textarea.style, styles);\n    textarea.focus();\n  }\n  hide() {\n    this.textarea.style.display = 'none';\n    this.textarea.value = '';\n  }\n  isEditing() {\n    return this.textarea.style.display !== 'none';\n  }\n  destroy() {\n    this.textarea.remove();\n  }\n}","map":{"version":3,"names":["cloneDeep","TextGraph","AddShapeCommand","TextEditor","constructor","editor","textarea","x","y","document","createElement","setStyle","hide","bindEvent","containerElement","appendChild","styles","background","border","outline","resize","padding","fontFamily","lineHeight","position","overflow","width","zIndex","Object","assign","style","addEventListener","e","key","createTextGraph","value","sceneXY","viewportCoordsToScene","setting","get","text","content","autoFit","fontSize","height","fill","sceneGraph","addItems","selectedElements","setItems","render","commandManager","pushCommand","visible","zoom","zoomManager","getZoom","left","top","display","focus","isEditing","destroy","remove"],"sources":["/Users/yangdan/zf-workspace/react/suika/packages/suika/src/editor/text/text_editor.ts"],"sourcesContent":["import cloneDeep from 'lodash.clonedeep';\nimport { Editor } from '../editor';\nimport { TextGraph } from '../scene/text';\nimport { AddShapeCommand } from '../commands/add_shape';\n\nexport class TextEditor {\n  textarea: HTMLInputElement;\n  x = -1;\n  y = -1;\n\n  constructor(private editor: Editor) {\n    this.textarea = document.createElement('input');\n    this.setStyle();\n    this.hide();\n    this.bindEvent();\n    editor.containerElement.appendChild(this.textarea);\n  }\n  private setStyle() {\n    const styles = {\n      background: 'transparent',\n      border: 'none',\n      outline: 'none',\n      resize: 'none',\n      padding: '0',\n      fontFamily: 'sans-serif',\n      lineHeight: '1',\n      position: 'absolute',\n      overflow: 'hidden',\n      width: '240px',\n      zIndex: '20',\n    } as const;\n    Object.assign(this.textarea.style, styles);\n  }\n  private bindEvent() {\n    this.textarea.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        this.hide();\n      }\n    });\n    this.textarea.addEventListener('blur', () => {\n      this.createTextGraph();\n      this.hide();\n    });\n  }\n  private createTextGraph() {\n    if (!this.textarea.value) return;\n\n    const sceneXY = this.editor.viewportCoordsToScene(\n      this.x,\n      this.y,\n      this.editor.setting.get('snapToPixelGrid'),\n    );\n    const text = new TextGraph({\n      x: sceneXY.x,\n      y: sceneXY.y,\n      content: this.textarea.value,\n      autoFit: true,\n      fontSize: this.editor.setting.get('defaultFontSize'),\n      height: this.editor.setting.get('defaultFontSize'),\n      fill: cloneDeep(this.editor.setting.get('textFill')),\n    });\n    this.editor.sceneGraph.addItems([text]);\n\n    this.editor.selectedElements.setItems([text]);\n    this.editor.sceneGraph.render();\n\n    this.editor.commandManager.pushCommand(\n      new AddShapeCommand('draw text', this.editor, [text]),\n    );\n  }\n  visible(x: number, y: number) {\n    this.x = x;\n    this.y = y;\n    const zoom = this.editor.zoomManager.getZoom();\n    const textarea = this.textarea;\n\n    const fontSize = this.editor.setting.get('defaultFontSize') * zoom + 'px';\n    const styles = {\n      left: x + 'px',\n      top: y + 'px',\n      height: fontSize,\n      fontSize,\n      display: 'block',\n    } as const;\n    Object.assign(textarea.style, styles);\n\n    textarea.focus();\n  }\n  hide() {\n    this.textarea.style.display = 'none';\n    this.textarea.value = '';\n  }\n  isEditing() {\n    return this.textarea.style.display !== 'none';\n  }\n  destroy() {\n    this.textarea.remove();\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}