{"ast":null,"code":"import { useRef } from 'react';\nimport useUnmount from '../useUnmount';\nimport depsAreSame from './depsAreSame';\nimport { getTargetElement } from './domTarget';\nconst createEffectWithTarget = useEffectType => {\n  /**\n   *\n   * @param effect\n   * @param deps\n   * @param target target should compare ref.current vs ref.current, dom vs dom, ()=>dom vs ()=>dom\n   */\n  const useEffectWithTarget = (effect, deps, target) => {\n    const hasInitRef = useRef(false);\n    const lastElementRef = useRef([]);\n    const lastDepsRef = useRef([]);\n    const unLoadRef = useRef();\n    useEffectType(() => {\n      var _a;\n      const targets = Array.isArray(target) ? target : [target];\n      const els = targets.map(item => getTargetElement(item));\n      // init run\n      if (!hasInitRef.current) {\n        hasInitRef.current = true;\n        lastElementRef.current = els;\n        lastDepsRef.current = deps;\n        unLoadRef.current = effect();\n        return;\n      }\n      if (els.length !== lastElementRef.current.length || !depsAreSame(els, lastElementRef.current) || !depsAreSame(deps, lastDepsRef.current)) {\n        (_a = unLoadRef.current) === null || _a === void 0 ? void 0 : _a.call(unLoadRef);\n        lastElementRef.current = els;\n        lastDepsRef.current = deps;\n        unLoadRef.current = effect();\n      }\n    });\n    useUnmount(() => {\n      var _a;\n      (_a = unLoadRef.current) === null || _a === void 0 ? void 0 : _a.call(unLoadRef);\n      // for react-refresh\n      hasInitRef.current = false;\n    });\n  };\n  return useEffectWithTarget;\n};\nexport default createEffectWithTarget;","map":{"version":3,"names":["useRef","useUnmount","depsAreSame","getTargetElement","createEffectWithTarget","useEffectType","useEffectWithTarget","effect","deps","target","hasInitRef","lastElementRef","lastDepsRef","unLoadRef","_a","targets","Array","isArray","els","map","item","current","length","call"],"sources":["/Users/yangdan/zf-workspace/react/suika/node_modules/.pnpm/registry.npmmirror.com+ahooks@3.7.4_react@18.2.0/node_modules/ahooks/es/utils/createEffectWithTarget.js"],"sourcesContent":["import { useRef } from 'react';\nimport useUnmount from '../useUnmount';\nimport depsAreSame from './depsAreSame';\nimport { getTargetElement } from './domTarget';\nconst createEffectWithTarget = useEffectType => {\n  /**\n   *\n   * @param effect\n   * @param deps\n   * @param target target should compare ref.current vs ref.current, dom vs dom, ()=>dom vs ()=>dom\n   */\n  const useEffectWithTarget = (effect, deps, target) => {\n    const hasInitRef = useRef(false);\n    const lastElementRef = useRef([]);\n    const lastDepsRef = useRef([]);\n    const unLoadRef = useRef();\n    useEffectType(() => {\n      var _a;\n      const targets = Array.isArray(target) ? target : [target];\n      const els = targets.map(item => getTargetElement(item));\n      // init run\n      if (!hasInitRef.current) {\n        hasInitRef.current = true;\n        lastElementRef.current = els;\n        lastDepsRef.current = deps;\n        unLoadRef.current = effect();\n        return;\n      }\n      if (els.length !== lastElementRef.current.length || !depsAreSame(els, lastElementRef.current) || !depsAreSame(deps, lastDepsRef.current)) {\n        (_a = unLoadRef.current) === null || _a === void 0 ? void 0 : _a.call(unLoadRef);\n        lastElementRef.current = els;\n        lastDepsRef.current = deps;\n        unLoadRef.current = effect();\n      }\n    });\n    useUnmount(() => {\n      var _a;\n      (_a = unLoadRef.current) === null || _a === void 0 ? void 0 : _a.call(unLoadRef);\n      // for react-refresh\n      hasInitRef.current = false;\n    });\n  };\n  return useEffectWithTarget;\n};\nexport default createEffectWithTarget;"],"mappings":"AAAA,SAASA,MAAM,QAAQ,OAAO;AAC9B,OAAOC,UAAU,MAAM,eAAe;AACtC,OAAOC,WAAW,MAAM,eAAe;AACvC,SAASC,gBAAgB,QAAQ,aAAa;AAC9C,MAAMC,sBAAsB,GAAGC,aAAa,IAAI;EAC9C;AACF;AACA;AACA;AACA;AACA;EACE,MAAMC,mBAAmB,GAAGA,CAACC,MAAM,EAAEC,IAAI,EAAEC,MAAM,KAAK;IACpD,MAAMC,UAAU,GAAGV,MAAM,CAAC,KAAK,CAAC;IAChC,MAAMW,cAAc,GAAGX,MAAM,CAAC,EAAE,CAAC;IACjC,MAAMY,WAAW,GAAGZ,MAAM,CAAC,EAAE,CAAC;IAC9B,MAAMa,SAAS,GAAGb,MAAM,CAAC,CAAC;IAC1BK,aAAa,CAAC,MAAM;MAClB,IAAIS,EAAE;MACN,MAAMC,OAAO,GAAGC,KAAK,CAACC,OAAO,CAACR,MAAM,CAAC,GAAGA,MAAM,GAAG,CAACA,MAAM,CAAC;MACzD,MAAMS,GAAG,GAAGH,OAAO,CAACI,GAAG,CAACC,IAAI,IAAIjB,gBAAgB,CAACiB,IAAI,CAAC,CAAC;MACvD;MACA,IAAI,CAACV,UAAU,CAACW,OAAO,EAAE;QACvBX,UAAU,CAACW,OAAO,GAAG,IAAI;QACzBV,cAAc,CAACU,OAAO,GAAGH,GAAG;QAC5BN,WAAW,CAACS,OAAO,GAAGb,IAAI;QAC1BK,SAAS,CAACQ,OAAO,GAAGd,MAAM,CAAC,CAAC;QAC5B;MACF;MACA,IAAIW,GAAG,CAACI,MAAM,KAAKX,cAAc,CAACU,OAAO,CAACC,MAAM,IAAI,CAACpB,WAAW,CAACgB,GAAG,EAAEP,cAAc,CAACU,OAAO,CAAC,IAAI,CAACnB,WAAW,CAACM,IAAI,EAAEI,WAAW,CAACS,OAAO,CAAC,EAAE;QACxI,CAACP,EAAE,GAAGD,SAAS,CAACQ,OAAO,MAAM,IAAI,IAAIP,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACS,IAAI,CAACV,SAAS,CAAC;QAChFF,cAAc,CAACU,OAAO,GAAGH,GAAG;QAC5BN,WAAW,CAACS,OAAO,GAAGb,IAAI;QAC1BK,SAAS,CAACQ,OAAO,GAAGd,MAAM,CAAC,CAAC;MAC9B;IACF,CAAC,CAAC;IACFN,UAAU,CAAC,MAAM;MACf,IAAIa,EAAE;MACN,CAACA,EAAE,GAAGD,SAAS,CAACQ,OAAO,MAAM,IAAI,IAAIP,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACS,IAAI,CAACV,SAAS,CAAC;MAChF;MACAH,UAAU,CAACW,OAAO,GAAG,KAAK;IAC5B,CAAC,CAAC;EACJ,CAAC;EACD,OAAOf,mBAAmB;AAC5B,CAAC;AACD,eAAeF,sBAAsB"},"metadata":{},"sourceType":"module","externalDependencies":[]}