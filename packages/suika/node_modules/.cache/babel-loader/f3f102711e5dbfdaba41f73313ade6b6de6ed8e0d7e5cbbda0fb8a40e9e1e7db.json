{"ast":null,"code":"import { useRef } from 'react';\nconst useRetryPlugin = (fetchInstance, {\n  retryInterval,\n  retryCount\n}) => {\n  const timerRef = useRef();\n  const countRef = useRef(0);\n  const triggerByRetry = useRef(false);\n  if (!retryCount) {\n    return {};\n  }\n  return {\n    onBefore: () => {\n      if (!triggerByRetry.current) {\n        countRef.current = 0;\n      }\n      triggerByRetry.current = false;\n      if (timerRef.current) {\n        clearTimeout(timerRef.current);\n      }\n    },\n    onSuccess: () => {\n      countRef.current = 0;\n    },\n    onError: () => {\n      countRef.current += 1;\n      if (retryCount === -1 || countRef.current <= retryCount) {\n        // Exponential backoff\n        const timeout = retryInterval !== null && retryInterval !== void 0 ? retryInterval : Math.min(1000 * Math.pow(2, countRef.current), 30000);\n        timerRef.current = setTimeout(() => {\n          triggerByRetry.current = true;\n          fetchInstance.refresh();\n        }, timeout);\n      } else {\n        countRef.current = 0;\n      }\n    },\n    onCancel: () => {\n      countRef.current = 0;\n      if (timerRef.current) {\n        clearTimeout(timerRef.current);\n      }\n    }\n  };\n};\nexport default useRetryPlugin;","map":{"version":3,"names":["useRef","useRetryPlugin","fetchInstance","retryInterval","retryCount","timerRef","countRef","triggerByRetry","onBefore","current","clearTimeout","onSuccess","onError","timeout","Math","min","pow","setTimeout","refresh","onCancel"],"sources":["/Users/yangdan/zf-workspace/react/suika/node_modules/.pnpm/registry.npmmirror.com+ahooks@3.7.4_react@18.2.0/node_modules/ahooks/es/useRequest/src/plugins/useRetryPlugin.js"],"sourcesContent":["import { useRef } from 'react';\nconst useRetryPlugin = (fetchInstance, {\n  retryInterval,\n  retryCount\n}) => {\n  const timerRef = useRef();\n  const countRef = useRef(0);\n  const triggerByRetry = useRef(false);\n  if (!retryCount) {\n    return {};\n  }\n  return {\n    onBefore: () => {\n      if (!triggerByRetry.current) {\n        countRef.current = 0;\n      }\n      triggerByRetry.current = false;\n      if (timerRef.current) {\n        clearTimeout(timerRef.current);\n      }\n    },\n    onSuccess: () => {\n      countRef.current = 0;\n    },\n    onError: () => {\n      countRef.current += 1;\n      if (retryCount === -1 || countRef.current <= retryCount) {\n        // Exponential backoff\n        const timeout = retryInterval !== null && retryInterval !== void 0 ? retryInterval : Math.min(1000 * Math.pow(2, countRef.current), 30000);\n        timerRef.current = setTimeout(() => {\n          triggerByRetry.current = true;\n          fetchInstance.refresh();\n        }, timeout);\n      } else {\n        countRef.current = 0;\n      }\n    },\n    onCancel: () => {\n      countRef.current = 0;\n      if (timerRef.current) {\n        clearTimeout(timerRef.current);\n      }\n    }\n  };\n};\nexport default useRetryPlugin;"],"mappings":"AAAA,SAASA,MAAM,QAAQ,OAAO;AAC9B,MAAMC,cAAc,GAAGA,CAACC,aAAa,EAAE;EACrCC,aAAa;EACbC;AACF,CAAC,KAAK;EACJ,MAAMC,QAAQ,GAAGL,MAAM,CAAC,CAAC;EACzB,MAAMM,QAAQ,GAAGN,MAAM,CAAC,CAAC,CAAC;EAC1B,MAAMO,cAAc,GAAGP,MAAM,CAAC,KAAK,CAAC;EACpC,IAAI,CAACI,UAAU,EAAE;IACf,OAAO,CAAC,CAAC;EACX;EACA,OAAO;IACLI,QAAQ,EAAEA,CAAA,KAAM;MACd,IAAI,CAACD,cAAc,CAACE,OAAO,EAAE;QAC3BH,QAAQ,CAACG,OAAO,GAAG,CAAC;MACtB;MACAF,cAAc,CAACE,OAAO,GAAG,KAAK;MAC9B,IAAIJ,QAAQ,CAACI,OAAO,EAAE;QACpBC,YAAY,CAACL,QAAQ,CAACI,OAAO,CAAC;MAChC;IACF,CAAC;IACDE,SAAS,EAAEA,CAAA,KAAM;MACfL,QAAQ,CAACG,OAAO,GAAG,CAAC;IACtB,CAAC;IACDG,OAAO,EAAEA,CAAA,KAAM;MACbN,QAAQ,CAACG,OAAO,IAAI,CAAC;MACrB,IAAIL,UAAU,KAAK,CAAC,CAAC,IAAIE,QAAQ,CAACG,OAAO,IAAIL,UAAU,EAAE;QACvD;QACA,MAAMS,OAAO,GAAGV,aAAa,KAAK,IAAI,IAAIA,aAAa,KAAK,KAAK,CAAC,GAAGA,aAAa,GAAGW,IAAI,CAACC,GAAG,CAAC,IAAI,GAAGD,IAAI,CAACE,GAAG,CAAC,CAAC,EAAEV,QAAQ,CAACG,OAAO,CAAC,EAAE,KAAK,CAAC;QAC1IJ,QAAQ,CAACI,OAAO,GAAGQ,UAAU,CAAC,MAAM;UAClCV,cAAc,CAACE,OAAO,GAAG,IAAI;UAC7BP,aAAa,CAACgB,OAAO,CAAC,CAAC;QACzB,CAAC,EAAEL,OAAO,CAAC;MACb,CAAC,MAAM;QACLP,QAAQ,CAACG,OAAO,GAAG,CAAC;MACtB;IACF,CAAC;IACDU,QAAQ,EAAEA,CAAA,KAAM;MACdb,QAAQ,CAACG,OAAO,GAAG,CAAC;MACpB,IAAIJ,QAAQ,CAACI,OAAO,EAAE;QACpBC,YAAY,CAACL,QAAQ,CAACI,OAAO,CAAC;MAChC;IACF;EACF,CAAC;AACH,CAAC;AACD,eAAeR,cAAc"},"metadata":{},"sourceType":"module","externalDependencies":[]}